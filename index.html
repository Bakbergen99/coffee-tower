<!DOCTYPE html>
<html lang="kz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Tower</title>
    <style>
        body {
            margin: 0;
            font-family: 'Comic Sans MS', cursive;
            background: url('https://i.imgur.com/YphsTBl.png') no-repeat center center fixed;
            background-size: cover;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        h1 {
            color: #4B2E2E;
            text-shadow: 2px 2px 4px #fff;
            margin: 20px;
            text-align: center;
        }

        #statusText {
            font-size: 18px;
            color: #222;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            text-align: center;
            min-height: 22px;
            /* Ensure consistent height */
        }

        #game {
            position: relative;
            width: 180px;
            /* Slightly wider for better playability */
            height: 450px;
            /* Slightly taller */
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            border: 2px solid #555;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .block {
            width: 60px;
            height: 60px;
            background: url('https://cdn-icons-png.flaticon.com/512/924/924514.png') no-repeat center;
            background-size: 100% 100%;
            position: absolute;
            /* bottom: 0; –ï–Ω–¥—ñ –±“±–Ω—ã JavaScript –∞—Ä“õ—ã–ª—ã –±–∞—Å“õ–∞—Ä–∞–º—ã–∑ */
            left: 50%;
            transform: translateX(-50%);
            transition: top 0.1s linear;
            /* Smooth drop animation */
        }

        button {
            margin: 8px;
            padding: 12px 25px;
            background-color: #6b4c3b;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #5a3e2e;
        }

        #result {
            margin-top: 15px;
            color: #000;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            min-height: 25px;
            /* Ensure consistent height */
        }

        #buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;
        }

        #audioControl {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            background: white;
            border-radius: 50%;
            padding: 10px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        /* Responsive design */
        @media (max-width: 600px) {
            h1 {
                font-size: 24px;
                margin: 15px;
            }

            #statusText {
                font-size: 16px;
                padding: 6px 10px;
            }

            #game {
                width: 150px;
                height: 380px;
            }

            .block {
                width: 50px;
                /* Adjust block width for smaller screens */
                height: 50px;
                background-size: 100% 100%;
            }

            button {
                padding: 10px 20px;
                font-size: 16px;
                margin: 6px;
            }

            #result {
                font-size: 18px;
                margin-top: 10px;
            }

            #audioControl {
                font-size: 24px;
                bottom: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
            }
        }
    </style>
</head>

<body>
    <h1>üèóÔ∏è Coffee Tower ‚òï</h1>
    <div id="statusText">–û–π—ã–Ω–¥—ã –±–∞—Å—Ç–∞—É “Ø—à—ñ–Ω —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑ üëá</div>
    <div id="game"></div>
    <div id="buttons">
        <button id="startBtn" onclick="startGame()">  –û–π–Ω–∞—É</button>
        <button id="backBtn" onclick="goBack()">üîô –ê—Ä—Ç“õ–∞</button>
    </div>
    <div id="result"></div>
    <div id="audioControl" onclick="toggleAudio()">üîä</div>
    <audio id="bgmusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <script>
        const game = document.getElementById('game');
        const blockHeight = 60; // Height of each coffee cup block
        const maxVisibleBlocks = 6; // –≠–∫—Ä–∞–Ω–¥–∞ –∫”©—Ä—ñ–Ω–µ—Ç—ñ–Ω –º–∞–∫—Å–∏–º–∞–ª–¥—ã —Å—Ç–∞–∫–∞–Ω —Å–∞–Ω—ã
        let currentBlock = null;
        let currentLeft = 50; // Initial percentage for horizontal position
        let direction = 1; // 1 for right, -1 for left
        let level = 0; // Current tower level (number of blocks stacked)
        let gameOver = false;
        let moveIntervalId; // To store the interval ID for moving block

        const statusText = document.getElementById('statusText');
        const resultText = document.getElementById('result');
        const buttonsContainer = document.getElementById('buttons');
        const audio = document.getElementById('bgmusic');
        const audioControl = document.getElementById('audioControl');

        const coffeeNames = ["–≠—Å–ø—Ä–µ—Å—Å–æ", "–ö–∞–ø—É—á–∏–Ω–æ", "–õ–∞—Ç—Ç–µ", "–ê–º–µ—Ä–∏–∫–∞–Ω–æ", "–§–ª—ç—Ç –£–∞–π—Ç", "–ú–∞–∫–∏–∞—Ç–æ", "–ú–æ–∫–∫–æ", "–†–∞—Ñ"];
        const emojis = ["üòé", "üòÅ", "üò¨", "ü§î", "üòµ", "üëç", "ü•≥", "ü§©"];

        // Function to update buttons based on game state
        function updateButtons(state) {
            if (state === 'playing') {
                buttonsContainer.innerHTML = `
                    <button onclick="dropBlock()">üì• –°—Ç–∞–∫–∞–Ω–¥—ã “õ–æ—é</button>
                    <button onclick="stopGame()">‚õî –¢–æ“õ—Ç–∞—Ç—É</button>
                `;
            } else if (state === 'start') {
                buttonsContainer.innerHTML = `
                    <button id="startBtn" onclick="startGame()">üéÆ –û–π–Ω–∞—É</button>
                    <button id="backBtn" onclick="goBack()">üîô –ê—Ä—Ç“õ–∞</button>
                `;
            } else if (state === 'end') {
                buttonsContainer.innerHTML = `
                    <button onclick="startGame()">üîÅ “ö–∞–π—Ç–∞ –æ–π–Ω–∞—É</button>
                    <button onclick="goBack()">üîô –ê—Ä—Ç“õ–∞</button>
                `;
            }
        }

        // Initialize game state
        function initGame() {
            game.innerHTML = ''; // Clear previous blocks
            level = 0;
            gameOver = false;
            currentBlock = null;
            currentLeft = 50; // Ensure initial position is 50% for next block
            direction = 1;
            clearInterval(moveIntervalId); // Clear any existing move interval
            resultText.innerText = '';
            statusText.innerText = '–û–π—ã–Ω–¥—ã –±–∞—Å—Ç–∞—É “Ø—à—ñ–Ω —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑ üëá';
            updateButtons('start');

            // –û–π—ã–Ω –±–∞—Å—Ç–∞–ª“ì–∞–Ω–¥–∞ –µ“£ –∞—Å—Ç—ã–Ω–¥–∞ –±—ñ—Ä—ñ–Ω—à—ñ (–±–∞–∑–∞–ª—ã“õ) —Å—Ç–∞–∫–∞–Ω–¥—ã “õ–æ—Å—É
            createBaseBlock();
        }

        // –ï“£ –∞—Å—Ç—ã–Ω–¥–∞ —Ç“±—Ä–∞—Ç—ã–Ω –±–µ–∫—ñ—Ç—ñ–ª–≥–µ–Ω —Å—Ç–∞–∫–∞–Ω–¥—ã –∂–∞—Å–∞–π–¥—ã
        function createBaseBlock() {
            const baseBlock = document.createElement('div');
            baseBlock.classList.add('block');
            // –ë—ñ—Ä—ñ–Ω—à—ñ —Å—Ç–∞–∫–∞–Ω–¥—ã –æ–π—ã–Ω –∞–ª–∞“£—ã–Ω—ã“£ –µ“£ —Ç”©–º–µ–Ω–≥—ñ –∂–∞“ì—ã–Ω–∞ –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä–∞–º—ã–∑
            baseBlock.style.top = (game.clientHeight - blockHeight) + 'px';
            // –û—Ä—Ç–∞“ì–∞ —Ç—É—Ä–∞–ª–∞—É “Ø—à—ñ–Ω CSS-—Ç–µ–≥—ñ transform: translateX(-50%) “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã
            game.appendChild(baseBlock);
            // –ë“±–ª —Å—Ç–∞–∫–∞–Ω “õ–æ–∑“ì–∞–ª–º–∞–π–¥—ã, —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω –æ–Ω—ã —Ç—ñ–∑—ñ–º–≥–µ “õ–æ—Å–ø–∞–π–º—ã–∑, —Ç–µ–∫ –≤–∏–∑—É–∞–ª–¥—ã –±–∞–∑–∞ —Ä–µ—Ç—ñ–Ω–¥–µ
        }

        function startGame() {
            initGame(); // Reset everything and create the base block
            statusText.innerText = '‚òùÔ∏è –°—Ç–∞–∫–∞–Ω–¥—ã –¥”ô–ª –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä—ã“£—ã–∑!';
            updateButtons('playing');
            createMovingBlock(); // –ë—ñ—Ä—ñ–Ω—à—ñ “õ–æ–∑“ì–∞–ª–∞—Ç—ã–Ω —Å—Ç–∞–∫–∞–Ω–¥—ã –∂–∞—Å–∞–π–º—ã–∑
            // Try to play audio, user interaction required for autoplay in most browsers
            if (audio.paused) {
                audio.play().catch(e => console.log("Audio play failed, user interaction required:", e));
            }
            audioControl.innerText = 'üîä';
        }

        function stopGame() {
            gameOver = true;
            clearInterval(moveIntervalId);
            statusText.innerText = '‚õî –û–π—ã–Ω —Ç–æ“õ—Ç–∞—Ç—ã–ª–¥—ã';
            resultText.innerText = `‚òï –ú“±–Ω–∞—Ä–∞ –±–∏—ñ–∫—Ç—ñ–≥—ñ: ${level} “õ–∞–±–∞—Ç`;
            updateButtons('end');
        }

        function goBack() {
            location.reload(); // Simple reload to go back to initial state
        }

        function createMovingBlock() {
            if (gameOver) return;

            currentBlock = document.createElement('div');
            currentBlock.classList.add('block');
            currentBlock.style.top = '0px'; // Always start from the top
            // CSS –∞—Ä“õ—ã–ª—ã left: 50%; transform: translateX(-50%); “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã
            game.appendChild(currentBlock);
            moveBlock(); // moveBlock –∞–ª“ì–∞—à“õ—ã –ø–æ–∑–∏—Ü–∏—è–Ω—ã –æ—Ä–Ω–∞—Ç—É “Ø—à—ñ–Ω —à–∞“õ—ã—Ä—ã–ª–∞–¥—ã
        }

        function moveBlock() {
            clearInterval(moveIntervalId);

            const moveSpeed = 3 + (level * 0.5); // Increase speed with level
            moveIntervalId = setInterval(() => {
                if (!currentBlock || gameOver) {
                    clearInterval(moveIntervalId);
                    return;
                }
                currentLeft += direction * moveSpeed / 10;
                if (currentLeft >= 85 || currentLeft <= 15) {
                    direction *= -1;
                }
                currentBlock.style.left = currentLeft + '%';
            }, 30);
        }

        function dropBlock() {
            if (!currentBlock || gameOver) return;

            clearInterval(moveIntervalId);

            const currentBlockRect = currentBlock.getBoundingClientRect();
            const gameRect = game.getBoundingClientRect();

            const currentBlockCenterX = (currentBlockRect.left - gameRect.left) + (currentBlockRect.width / 2);

            // –ï–Ω–¥—ñ –∞–ª–¥—ã“£“ì—ã –±–ª–æ–∫—Ç—ã game.children —Ç—ñ–∑—ñ–º—ñ–Ω–µ–Ω –∞–ª–∞–º—ã–∑
            // –ë—ñ—Ä—ñ–Ω—à—ñ —Å—Ç–∞–∫–∞–Ω–¥—ã —Å–∞–Ω–∞–º–∞–π–º—ã–∑, —Å–µ–±–µ–±—ñ –æ–ª –±–∞–∑–∞–ª—ã“õ
            let prevBlockIndex = game.children.length - 2; // game.children[0] - –±–∞–∑–∞–ª—ã“õ —Å—Ç–∞–∫–∞–Ω, [1] - –±—ñ—Ä—ñ–Ω—à—ñ “õ–æ–π—ã–ª“ì–∞–Ω —Å—Ç–∞–∫–∞–Ω
            if (level === 0) {
                // –ï–≥–µ—Ä –±“±–ª –±—ñ—Ä—ñ–Ω—à—ñ “õ–æ–π—ã–ª–∞—Ç—ã–Ω —Å—Ç–∞–∫–∞–Ω –±–æ–ª—Å–∞, –±–∞–∑–∞–ª—ã“õ —Å—Ç–∞–∫–∞–Ω–¥—ã –∞–ª–∞–º—ã–∑
                prevBlockIndex = 0;
            }

            const prevBlock = game.children[prevBlockIndex];
            const prevBlockRect = prevBlock.getBoundingClientRect();
            const prevBlockCenterX = (prevBlockRect.left - gameRect.left) + (prevBlockRect.width / 2);

            const offset = Math.abs(currentBlockCenterX - prevBlockCenterX);

            const coffee = coffeeNames[Math.floor(Math.random() * coffeeNames.length)];
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];

            const tolerance = 15; // –†“±“õ—Å–∞—Ç –µ—Ç—ñ–ª–≥–µ–Ω –∞—É—ã—Ç“õ—É (–ø–∏–∫—Å–µ–ª—å–º–µ–Ω)

            if (offset > tolerance) {
                statusText.innerText = `‚òùÔ∏è ${level + 1}-“õ–∞–±–∞—Ç: ${coffee} “õ–∏—Å—ã“õ —Ç“Ø—Å—Ç—ñ ${emoji}`;
                resultText.innerText = `‚òï –û–π—ã–Ω –±—ñ—Ç—Ç—ñ! –ú“±–Ω–∞—Ä–∞ –±–∏—ñ–∫—Ç—ñ–≥—ñ: ${level} “õ–∞–±–∞—Ç`;
                gameOver = true;
                updateButtons('end');
                currentBlock.style.left = ((currentBlockCenterX / gameRect.width) * 100) + '%';
                return;
            } else {
                level++;
                statusText.innerText = `‚òùÔ∏è ${level}-“õ–∞–±–∞—Ç: ${coffee} –¥”ô–ª —Ç“Ø—Å—Ç—ñ ${emoji}`;
                currentBlock.style.left = ((prevBlockCenterX / gameRect.width) * 100) + '%';
            }

            // –°—Ç–∞–∫–∞–Ω–¥–∞—Ä–¥—ã —Ç”©–º–µ–Ω–≥–µ –∂—ã–ª–∂—ã—Ç—É –∂”ô–Ω–µ –µ“£ —Ç”©–º–µ–Ω–≥—ñ—Å—ñ–Ω –∂–æ—é
            // –ï–≥–µ—Ä –∫”©—Ä—ñ–Ω–µ—Ç—ñ–Ω —Å—Ç–∞–∫–∞–Ω —Å–∞–Ω—ã –º–∞–∫—Å–∏–º–∞–ª–¥—ã–¥–∞–Ω –∞—Å—ã–ø –∫–µ—Ç—Å–µ
            if (game.children.length > maxVisibleBlocks) {
                const oldestBlock = game.children[1]; // game.children[0] –±–∞–∑–∞–ª—ã“õ —Å—Ç–∞–∫–∞–Ω
                game.removeChild(oldestBlock);

                // “ö–∞–ª“ì–∞–Ω —Å—Ç–∞–∫–∞–Ω–¥–∞—Ä–¥—ã —Ç”©–º–µ–Ω “õ–∞—Ä–∞–π –∂—ã–ª–∂—ã—Ç—É
                for (let i = 1; i < game.children.length; i++) { // –ë–∞–∑–∞–ª—ã“õ —Å—Ç–∞–∫–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω–≥—ñ–¥–µ–Ω –±–∞—Å—Ç–∞–π–º—ã–∑
                    const block = game.children[i];
                    // –ï—Å–µ–ø—Ç–µ—É “Ø—à—ñ–Ω blockHeight ”©–ª—à–µ–º—ñ–Ω “õ–æ–ª–¥–∞–Ω–∞–º—ã–∑
                    const currentBlockTop = parseInt(block.style.top);
                    block.style.top = (currentBlockTop + blockHeight) + 'px';
                }
            }


            // –ñ–∞“£–∞ —Ç“Ø—Å–∫–µ–Ω –±–ª–æ–∫—Ç—ã –¥“±—Ä—ã—Å –ø–æ–∑–∏—Ü–∏—è“ì–∞ “õ–æ—é
            // –ï–Ω–¥—ñ –±–∞—Ä–ª—ã“õ –±–ª–æ–∫—Ç—ã“£ –ø–æ–∑–∏—Ü–∏—è—Å—ã–Ω “õ–∞–π—Ç–∞ –µ—Å–µ–ø—Ç–µ–π–º—ñ–∑
            // –ë–∞–∑–∞–ª—ã“õ –±–ª–æ–∫—Ç—ã –µ—Å–µ–ø—Ç–µ–º–µ–π, —Ç–µ–∫ “õ–æ–π—ã–ª“ì–∞–Ω –±–ª–æ–∫—Ç—ã“£ —Å–∞–Ω—ã–Ω –∞–ª–∞–º—ã–∑ (game.children.length - 1)
            for (let i = 0; i < game.children.length; i++) {
                const block = game.children[i];
                if (i === 0) { // –ë–∞–∑–∞–ª—ã“õ –±–ª–æ–∫
                    block.style.top = (game.clientHeight - blockHeight) + 'px';
                } else {
                    // level - –±“±–ª –æ–π—ã–Ω—à—ã –∂–∏–Ω–∞“ì–∞–Ω “õ–∞–±–∞—Ç —Å–∞–Ω—ã
                    // i - –±“±–ª game.children —Ç—ñ–∑—ñ–º—ñ–Ω–¥–µ–≥—ñ –±–ª–æ–∫—Ç—ã“£ –∏–Ω–¥–µ–∫—Å—ñ
                    // –ë–ª–æ–∫—Ç–∞—Ä–¥—ã —Ç”©–º–µ–Ω–Ω–µ–Ω –∂–æ“ì–∞—Ä—ã“ì–∞ –¥“±—Ä—ã—Å –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä—É
                    // –ï–≥–µ—Ä maxVisibleBlocks —Ç–æ–ª“ì–∞–Ω –±–æ–ª—Å–∞, –µ“£ —Ç”©–º–µ–Ω–≥—ñ—Å—ñ –∂–æ“ì–∞–ª—ã–ø –∫–µ—Ç–µ–¥—ñ
                    const totalBlocksOnScreen = game.children.length; // “ö–∞–∑—ñ—Ä–≥—ñ —ç–∫—Ä–∞–Ω–¥–∞“ì—ã –±–ª–æ–∫—Ç–∞—Ä–¥—ã“£ —Å–∞–Ω—ã
                    const positionFromBottom = (totalBlocksOnScreen - i); // –¢”©–º–µ–Ω–Ω–µ–Ω —Å–∞–Ω–∞“ì–∞–Ω–¥–∞“ì—ã –æ—Ä–Ω—ã

                    block.style.top = (game.clientHeight - (positionFromBottom * blockHeight)) + 'px';
                }
            }

            // If game is not over, create the next block
            if (!gameOver) {
                currentBlock = null; // Clear reference to old block
                createMovingBlock();
            }
        }

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                audioControl.innerText = 'üîä';
            } else {
                audio.pause();
                audioControl.innerText = 'üîá';
            }
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>

</html>
 
